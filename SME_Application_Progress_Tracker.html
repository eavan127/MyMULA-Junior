<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>SME Registration Progress Tracker - MyMULA Junior</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0054a8",
            "background-light": "#f5f7f8",
            "background-dark": "#0f1923",
            "status-yellow": "#FBBF24",
            "status-green": "#10B981",
            "status-grey": "#D1D5DB",
          },
          fontFamily: {
            display: ["Public Sans", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "1rem",
            xl: "1.5rem",
            full: "9999px",
          },
        },
      },
    };
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
      font-size: 24px;
    }

    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
</head>

<body class="font-display">
  <div
    class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
    <div
      class="flex items-center bg-white dark:bg-background-dark p-4 pb-2 justify-between sticky top-0 z-10 shadow-sm">
      <div onclick="window.location.href='mainpage_applications.html'"
        class="text-[#101418] dark:text-white flex size-12 shrink-0 items-center justify-start -ml-2 cursor-pointer">
        <span class="material-symbols-outlined">arrow_back_ios_new</span>
      </div>
      <h2 class="text-[#101418] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">
        Application Progress Tracker</h2>
      <div class="flex size-12 shrink-0 items-center"></div>
    </div>
    <main class="flex-1 p-4 flex flex-col gap-6">
      <div
        class="flex flex-col items-stretch justify-start rounded-xl shadow-[0_0_12px_rgba(0,0,0,0.05)] bg-white dark:bg-gray-800 p-4 pb-6">
        <div class="flex w-full min-w-72 grow flex-col items-stretch justify-center gap-2 mb-4">
          <div class="flex items-center justify-between gap-4">
            <p class="text-[#101418] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">SME
              Registration - Sole Proprietorship</p>
            <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-status-yellow/20 px-4">
              <p class="text-status-yellow text-sm font-medium leading-normal">In Progress</p>
            </div>
          </div>
          <p class="text-[#5e758d] dark:text-gray-400 text-base font-normal leading-normal">Ref: MYMULA-SME-09250</p>
          <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">Penjejak Kemajuan Pendaftaran
          </p>
        </div>
        <div class="grid grid-cols-[40px_1fr] gap-x-2">
          <!-- Step 1: Guardian Approval -->
          <div class="flex flex-col items-center gap-1">
            <div id="step-1-icon"
              class="flex items-center justify-center size-10 rounded-full bg-status-grey text-white transition-colors duration-300">
              <span class="material-symbols-outlined">shield_person</span>
            </div>
            <div id="step-1-line" class="w-[2px] bg-status-grey h-full grow transition-colors duration-300"></div>
          </div>
          <div class="flex flex-1 flex-col pb-6 pt-2">
            <p id="step-1-title" class="text-[#101418] dark:text-white text-base font-medium leading-normal">Guardian
              Approval</p>
            <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">Kelulusan Penjaga</p>
            <p id="step-1-date" class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal mt-1">
              Pending...</p>
          </div>

          <!-- Step 2: SSM Name Verification -->
          <div class="flex flex-col items-center gap-1">
            <div id="step-2-top-line" class="w-[2px] bg-status-grey h-2 transition-colors duration-300"></div>
            <div id="step-2-icon"
              class="flex items-center justify-center size-10 rounded-full bg-status-grey text-white transition-colors duration-300">
              <span class="material-symbols-outlined">gavel</span>
            </div>
            <div id="step-2-line" class="w-[2px] bg-status-grey h-full grow transition-colors duration-300"></div>
          </div>
          <div class="flex flex-1 flex-col pb-6 pt-2">
            <p class="text-[#101418] dark:text-white text-base font-medium leading-normal">SSM Name Verification</p>
            <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">Pengesahan Nama SSM</p>
            <p id="step-2-date" class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal mt-1">--</p>
          </div>

          <!-- Step 3: Submitted -->
          <div class="flex flex-col items-center gap-1">
            <div id="step-3-top-line" class="w-[2px] bg-status-grey h-2 transition-colors duration-300"></div>
            <div id="step-3-icon"
              class="flex items-center justify-center size-10 rounded-full bg-status-grey text-white transition-colors duration-300">
              <span class="material-symbols-outlined">upload_file</span>
            </div>
            <div id="step-3-line" class="w-[2px] bg-status-grey h-full grow transition-colors duration-300"></div>
          </div>
          <div class="flex flex-1 flex-col pb-6 pt-2">
            <p class="text-[#101418] dark:text-white text-base font-medium leading-normal">Submitted</p>
            <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">Telah Dihantar</p>
            <p id="step-3-date" class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal mt-1">--</p>
          </div>

          <!-- Step 4: Registered -->
          <div class="flex flex-col items-center gap-1">
            <div id="step-4-top-line" class="w-[2px] bg-status-grey h-2 transition-colors duration-300"></div>
            <div id="step-4-icon"
              class="flex items-center justify-center size-10 rounded-full bg-status-grey/40 text-[#5e758d] dark:bg-gray-700 dark:text-gray-400 transition-colors duration-300">
              <span class="material-symbols-outlined">thumb_up</span>
            </div>
          </div>
          <div class="flex flex-1 flex-col pt-2">
            <p class="text-[#5e758d] dark:text-gray-400 text-base font-medium leading-normal">Registered</p>
            <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">Diluluskan</p>
          </div>
        </div>
      </div>
    </main>
    <div
      class="sticky bottom-0 bg-white dark:bg-background-dark p-4 border-t border-gray-200 dark:border-gray-700 flex justify-center">
      <button onclick="window.location.href='SME_view_document.html'"
        class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-5 flex-1 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] w-full shadow-lg shadow-primary/30">
        <span class="truncate">View Summary</span>
      </button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Ensure application is marked as submitted when visiting this page
      localStorage.setItem('sme_application_submitted', 'true');

      updateProgress();
      // Poll for changes every 2 seconds
      setInterval(updateProgress, 2000);
    });

    function updateProgress() {
      // Check localStorage first for cross-tab updates
      const isApproved = localStorage.getItem('sme_guardian_approved') === 'true' || sessionStorage.getItem('sme_guardian_approved') === 'true';

      // Also check child_requests for rejected status
      const requests = JSON.parse(localStorage.getItem('child_requests') || sessionStorage.getItem('child_requests') || '[]');
      const smeRequest = requests.find(r => r.type === 'sme' && r.status !== 'deleted');
      const isRejected = smeRequest && smeRequest.status === 'rejected';

      // Update Step 1: Guardian Approval
      const step1Icon = document.getElementById('step-1-icon');
      const step1Line = document.getElementById('step-1-line');
      const step1Date = document.getElementById('step-1-date');

      if (isRejected) {
        step1Icon.className = "flex items-center justify-center size-10 rounded-full bg-red-500 text-white transition-colors duration-300";
        step1Line.className = "w-[2px] bg-red-500 h-full grow transition-colors duration-300";
        step1Date.textContent = "Rejected by Guardian";
        step1Date.className = "text-red-500 text-sm font-medium leading-normal mt-1";
      } else if (isApproved) {
        step1Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-green text-white transition-colors duration-300";
        step1Line.className = "w-[2px] bg-status-green h-full grow transition-colors duration-300";
        step1Date.textContent = "Approved";
        step1Date.className = "text-status-green text-sm font-medium leading-normal mt-1";
      } else {
        step1Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-yellow text-white transition-colors duration-300";
        step1Line.className = "w-[2px] bg-status-grey h-full grow transition-colors duration-300";
        step1Date.textContent = "Waiting for Guardian...";
        step1Date.className = "text-status-yellow text-sm font-medium leading-normal mt-1";
      }

      // Update Step 2: SSM Name Verification
      const step2TopLine = document.getElementById('step-2-top-line');
      const step2Icon = document.getElementById('step-2-icon');
      const step2Line = document.getElementById('step-2-line');
      const step2Date = document.getElementById('step-2-date');

      if (isApproved) {
        step2TopLine.className = "w-[2px] bg-status-green h-2 transition-colors duration-300";
        step2Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-yellow text-white transition-colors duration-300";
        step2Line.className = "w-[2px] bg-status-grey h-full grow transition-colors duration-300";
        step2Date.textContent = "In Progress";
        step2Date.className = "text-status-yellow text-sm font-medium leading-normal mt-1";
      } else {
        step2TopLine.className = "w-[2px] bg-status-grey h-2 transition-colors duration-300";
        step2Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-grey text-white transition-colors duration-300";
        step2Date.textContent = "Pending";
        step2Date.className = "text-gray-400 text-sm font-normal leading-normal mt-1";
      }

      // Update Step 3: Submitted
      const step3TopLine = document.getElementById('step-3-top-line');
      const step3Icon = document.getElementById('step-3-icon');
      const step3Line = document.getElementById('step-3-line');
      const step3Date = document.getElementById('step-3-date');

      if (isApproved) {
        // Pending subsequent steps
        step3TopLine.className = "w-[2px] bg-status-grey h-2 transition-colors duration-300";
      } else {
        step3TopLine.className = "w-[2px] bg-status-grey h-2 transition-colors duration-300";
      }
      // Always gray for now as we don't have logic for step 3 completion
      step3Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-grey text-white transition-colors duration-300";
      step3Line.className = "w-[2px] bg-status-grey h-full grow transition-colors duration-300";
      step3Date.textContent = isApproved ? "Pending" : "--";
      step3Date.className = "text-gray-400 text-sm font-normal leading-normal mt-1";

      // Update Step 4: Registered
      const step4TopLine = document.getElementById('step-4-top-line');
      const step4Icon = document.getElementById('step-4-icon');

      step4TopLine.className = "w-[2px] bg-status-grey h-2 transition-colors duration-300";
      step4Icon.className = "flex items-center justify-center size-10 rounded-full bg-status-grey/40 text-[#5e758d] dark:bg-gray-700 dark:text-gray-400 transition-colors duration-300";
    }
  </script>
</body>

</html>
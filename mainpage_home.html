<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Home Dashboard (Enhanced UI) - MyMULA Junior</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0054A6",
            "accent": "#4CA9FF",
            "background-light": "#F7F9FC",
            "background-dark": "#0f1923",
          },
          fontFamily: {
            "display": ["Public Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "12px",
            "xl": "16px",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    .material-symbols-outlined.fill {
      font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    body {
      min-height: max(884px, 100dvh);
    }

    .bounce-on-tap:active {
      transform: scale(0.95);
      transition: transform 0.1s ease-in-out;
    }
  </style>
</head>

<body class="font-display bg-background-light">
  <div
    class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
    <div class="flex items-center bg-transparent dark:bg-background-dark p-4 justify-between">
      <div class="flex items-center gap-3">
        <img alt="Ali's avatar" class="h-12 w-12 rounded-full object-cover border-2 border-primary shadow-md"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuDPCkPYpsFrKyuL2q0wKCKpuzOi4pehvyVUPD_CyjBd3x6ml3D8IsF04UqGyXjYwha3tEJyz65UrQLJxhQoL5CT6ZxCYLaLmh6o3ZFrivlVBRZLnjzp0xw422ehXkulea3qL4He8lkwYMIKXmP-pTwIvdQ4rZ0SF1jYIiPX0bnyLaiTBeLnnCNWt9_oD6if7UddAmxHabrhqvNTMH1tCRpjsFZeaAtofbK1-NPQXfO4hmlvYib9UxO6Oto6udXG1K0j5_DWpiEd6Ik" />
        <h1 class="text-[#333333] dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] flex-1">Hi, Ali!
        </h1>
      </div>
      <div class="flex w-12 items-center justify-end relative">
        <button onclick="window.location.href='Notification.html'"
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-transparent text-[#333333] dark:text-white gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0">
          <span class="material-symbols-outlined notranslate !text-3xl">notifications</span>
        </button>
        <div class="absolute top-1 right-1 h-2.5 w-2.5 rounded-full bg-red-500 border-2 border-background-light"></div>
      </div>
    </div>
    <div class="px-4 pb-2">
      <p class="text-[#333333] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">What would you like
        to
        apply for today?</p>
    </div>

    <!-- CONTINUE APPLICATION SECTION (dynamically shown when drafts exist) -->
    <div id="continueSection" class="hidden px-4 pb-4">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-[#333333] dark:text-white text-base font-bold flex items-center gap-2">
          <span class="material-symbols-outlined notranslate text-orange-500">pending_actions</span>
          Continue Where You Left Off
        </h2>
      </div>
      <div id="draftCardsContainer" class="flex flex-col gap-3">
        <!-- Draft cards will be inserted here by JavaScript -->
      </div>
    </div>

    <div id="application-list" class="flex-grow flex flex-col gap-4 px-4">
      <!-- Applications will be loaded here -->
    </div>

    <!-- Recent Activity Section -->
    <div class="px-4 pb-3 pt-5">
      <h2 class="text-[#333333] dark:text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Recent Activity
      </h2>
      <p class="text-[#6c757d] dark:text-gray-400 text-sm font-medium leading-normal">Digital Curfew & Controls</p>
    </div>

    <div class="flex flex-col gap-3 px-4 pb-8">
      <!-- Curfew Status Card - View Only -->
      <div
        class="rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 border border-blue-200 dark:border-blue-800 shadow-sm">
        <div class="flex items-start gap-4">
          <div
            class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-blue-500 text-white shadow-sm">
            <span class="material-symbols-outlined notranslate text-xl">schedule</span>
          </div>
          <div class="flex-1">
            <p class="text-gray-900 dark:text-white text-sm font-bold mb-1">Curfew Status</p>
            <p class="text-[10px] text-gray-400 mb-2">Set by Guardian</p>
            <div class="space-y-1">
              <div class="flex items-center gap-2">
                <span id="home-curfew-status-badge"
                  class="px-2 py-0.5 rounded text-[10px] font-bold bg-gray-200 text-gray-600 uppercase tracking-wider">Unknown</span>
                <p class="text-xs text-gray-600 dark:text-gray-400" id="home-curfew-time-range">--:-- to --:--</p>
              </div>
              <p class="text-xs text-gray-500 dark:text-gray-500" id="home-curfew-msg">Checking settings...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Current Time Display -->
      <div
        class="flex items-center gap-3 rounded-xl bg-white dark:bg-gray-800 p-4 shadow-sm border border-gray-100 dark:border-gray-700">
        <div
          class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-600">
          <span class="material-symbols-outlined notranslate text-xl">access_time</span>
        </div>
        <div class="flex-1">
          <p class="text-[#101418] dark:text-white text-sm font-bold">Current Time</p>
          <p id="home-current-time" class="text-gray-500 dark:text-gray-400 text-xs font-mono">--:--:-- --</p>
        </div>
        <span id="home-curfew-active-indicator"
          class="px-2 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-700 uppercase">Outside
          Curfew</span>
      </div>

      <!-- Latest Update Log -->
      <div
        class="flex items-center gap-3 rounded-xl bg-white dark:bg-gray-800 p-4 shadow-sm border border-gray-100 dark:border-gray-700">
        <div
          class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 text-primary">
          <span class="material-symbols-outlined notranslate text-xl">history</span>
        </div>
        <div class="flex-1">
          <p class="text-[#101418] dark:text-white text-sm font-bold">Latest Update</p>
          <p id="home-curfew-last-update" class="text-gray-500 dark:text-gray-400 text-xs">Synced from settings</p>
        </div>
        <span id="home-update-time" class="text-xs text-gray-400">Just now</span>
      </div>

      <!-- Transaction Status Card (Dynamic) -->
      <div id="transaction-status-card"></div>
    </div>


  </div>
  <div class="h-5 bg-transparent"></div>
  <div class="sticky bottom-0">
    <div
      class="flex h-[72px] justify-around border-t border-[#f0f2f5] bg-white/80 px-4 pb-3 pt-2 dark:border-gray-700 dark:bg-background-dark/80 backdrop-blur-lg">

      <!-- 1. HOME BUTTON -->
      <a class="flex flex-1 flex-col items-center justify-end gap-1 rounded-full text-primary"
        href="mainpage_home.html">
        <div class="flex h-8 items-center justify-center">
          <span class="material-symbols-outlined notranslate fill">home</span>
        </div>
        <p class="text-primary text-xs font-semibold leading-normal tracking-[0.015em]">Home</p>
      </a>

      <!-- 2. MY APPLICATIONS BUTTON -->
      <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
        href="mainpage_applications.html">
        <div class="flex h-8 items-center justify-center">
          <span class="material-symbols-outlined notranslate">description</span>
        </div>
        <p class="text-xs font-semibold leading-normal tracking-[0.015em]">My Applications</p>
      </a>

      <!-- 3. PROFILE BUTTON -->
      <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
        href="mainpage_profile.html">
        <div class="flex h-8 items-center justify-center">
          <span class="material-symbols-outlined notranslate">account_circle</span>
        </div>
        <p class="text-xs font-semibold leading-normal tracking-[0.015em]">Profile</p>
      </a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('mock_data.json');
        const data = await response.json();
        const container = document.getElementById('application-list');

        if (container) {
          container.innerHTML = data.map(app => `
            <a class="flex items-center justify-between gap-4 rounded-xl bg-white dark:bg-gray-800 p-4 shadow-[0_2px_8px_rgba(0,0,0,0.05)] cursor-pointer active:scale-[0.98] transition-transform"
              href="${app.link}">
              <div
                class="flex h-14 w-14 shrink-0 items-center justify-center rounded-full bg-primary/20 text-primary dark:bg-primary/30 dark:text-blue-300">
                <span class="material-symbols-outlined notranslate text-3xl">${app.icon}</span>
              </div>
              <div class="flex flex-col gap-1 flex-1">
                <p class="text-[#101418] dark:text-white text-base font-bold leading-tight">${app.title}</p>
                <p class="text-[#5e758d] dark:text-gray-400 text-sm font-normal leading-normal">${app.description}</p>
                <div class="flex gap-2 flex-wrap pt-1">
                  ${app.tags.map(tag => `
                    <div
                      class="flex h-6 shrink-0 items-center justify-center gap-x-2 rounded-full ${tag.type === 'success' ? 'bg-green-200 dark:bg-green-800' : 'bg-gray-200 dark:bg-gray-700'} px-3">
                      <p class="${tag.type === 'success' ? 'text-green-800 dark:text-green-200' : 'text-gray-700 dark:text-gray-300'} text-xs font-medium leading-normal">${tag.text}</p>
                    </div>
                  `).join('')}
                </div>
              </div>
              <div class="text-[#5e758d] dark:text-gray-400">
                <span class="material-symbols-outlined notranslate">chevron_right</span>
              </div>
            </a>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading mock data:', error);
      }
    });
  </script>

  <!-- DRAFT APPLICATIONS SCRIPT -->
  <script>
    // Application type configurations
    const APP_TYPES = {
      scholarship: {
        name: 'PESP Scholarship',
        icon: 'school',
        color: 'blue',
        resumeUrl: 'scholarship_requirements.html'
      },
      sme: {
        name: 'SME Registration',
        icon: 'business_center',
        color: 'green',
        resumeUrl: 'SME_Application_Requirements.html'
      },
      dental: {
        name: 'Dental Checkup',
        icon: 'dentistry',
        color: 'purple',
        resumeUrl: 'Dental_Application_Requirements.html'
      }
    };

    // Load and display draft applications on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadDraftApplications();
    });

    function loadDraftApplications() {
      const container = document.getElementById('draftCardsContainer');
      const section = document.getElementById('continueSection');
      let hasDrafts = false;

      container.innerHTML = ''; // Clear existing

      // Check each application type for drafts
      Object.keys(APP_TYPES).forEach(type => {
        const draftKey = `draft_${type}`;
        // Check sessionStorage first, then localStorage for persistence (specifically dental)
        let draft = sessionStorage.getItem(draftKey);
        if (!draft && type === 'dental') {
          draft = localStorage.getItem(draftKey);
        }

        if (draft) {
          try {
            const draftData = JSON.parse(draft);
            hasDrafts = true;
            const card = createDraftCard(type, draftData);
            container.appendChild(card);
          } catch (e) {
            console.error(`Error parsing draft for ${type}:`, e);
          }
        }
      });

      // Show/hide section based on drafts
      if (hasDrafts) {
        section.classList.remove('hidden');
      } else {
        section.classList.add('hidden');
      }
    }

    function createDraftCard(type, draftData) {
      const config = APP_TYPES[type];
      const lastModified = draftData.lastModified ? formatTimeAgo(new Date(draftData.lastModified)) : 'Recently';
      const progress = draftData.progress || 'In progress';

      const card = document.createElement('div');
      card.className = 'flex items-center gap-3 rounded-xl bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 p-4 border border-orange-200 dark:border-orange-800 shadow-sm';
      card.innerHTML = `
        <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-${config.color}-100 dark:bg-${config.color}-900/30 text-${config.color}-500">
          <span class="material-symbols-outlined notranslate text-2xl">${config.icon}</span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-[#101418] dark:text-white text-sm font-bold truncate">${config.name}</p>
          <p class="text-orange-600 dark:text-orange-400 text-xs font-medium">${progress}</p>
          <p class="text-gray-500 dark:text-gray-400 text-xs">Last edited: ${lastModified}</p>
        </div>
        <div class="flex gap-2 shrink-0">
          <button onclick="discardDraft('${type}')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors" title="Discard">
            <span class="material-symbols-outlined notranslate text-gray-500 hover:text-red-500 text-xl">delete</span>
          </button>
          <button onclick="resumeDraft('${type}')" class="px-4 py-2 rounded-lg bg-primary text-white font-bold text-sm shadow-sm hover:bg-primary/90 transition-colors">
            Continue
          </button>
        </div>
      `;
      return card;
    }

    function formatTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMins / 60);
      const diffDays = Math.floor(diffHours / 24);

      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins} min ago`;
      if (diffHours < 24) return `${diffHours} hr ago`;
      if (diffDays < 7) return `${diffDays} days ago`;
      return date.toLocaleDateString();
    }

    function resumeDraft(type) {
      const config = APP_TYPES[type];
      // Mark that we're resuming a draft
      sessionStorage.setItem(`resuming_${type}`, 'true');
      window.location.href = config.resumeUrl;
    }

    function discardDraft(type) {
      if (confirm('Are you sure you want to discard this application? All saved progress will be lost.')) {
        // Remove from both sessionStorage and localStorage
        sessionStorage.removeItem(`draft_${type}`);
        localStorage.removeItem(`draft_${type}`);
        loadDraftApplications(); // Refresh the list
      }
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      updateRecentActivity();
      updateCurrentTime();
      updateTransactionStatus();
      // Update every second for real-time clock
      setInterval(updateCurrentTime, 1000);
      // Check curfew settings every 2 seconds
      setInterval(updateRecentActivity, 2000);
    });

    function updateTransactionStatus() {
      const container = document.getElementById('transaction-status-card');
      if (!container) return;

      const isApproved = localStorage.getItem('gaming_purchase_approved') === 'true';

      if (isApproved) {
        // Show approved/success card
        container.innerHTML = `
          <a href="Transaction_Progress_Tracker.html"
            class="flex items-center gap-3 rounded-xl bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 shadow-sm border border-green-200 dark:border-green-800 cursor-pointer hover:shadow-md transition-shadow">
            <div
              class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30 text-green-600">
              <span class="material-symbols-outlined notranslate text-xl">check_circle</span>
            </div>
            <div class="flex-1">
              <p class="text-[#101418] dark:text-white text-sm font-bold">Purchase Approved</p>
              <p class="text-green-600 dark:text-green-400 text-xs">Gaming purchase was accepted by guardian</p>
            </div>
            <div class="text-green-500 dark:text-green-400">
              <span class="material-symbols-outlined notranslate">chevron_right</span>
            </div>
          </a>
        `;
      } else {
        // Show intercepted/pending card
        container.innerHTML = `
          <a href="Transaction_intercepted.html"
            class="flex items-center gap-3 rounded-xl bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 p-4 shadow-sm border border-red-200 dark:border-red-800 cursor-pointer hover:shadow-md transition-shadow">
            <div
              class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/30 text-red-600">
              <span class="material-symbols-outlined notranslate text-xl">block</span>
            </div>
            <div class="flex-1">
              <p class="text-[#101418] dark:text-white text-sm font-bold">Transaction Intercepted</p>
              <p class="text-red-600 dark:text-red-400 text-xs">A suspicious transaction was blocked</p>
            </div>
            <div class="text-red-500 dark:text-red-400">
              <span class="material-symbols-outlined notranslate">chevron_right</span>
            </div>
          </a>
        `;
      }
    }

    function updateRecentActivity() {
      const isEnabled = localStorage.getItem('curfew_enabled') === 'true';
      const start = localStorage.getItem('curfew_start') || '22:00';
      const end = localStorage.getItem('curfew_end') || '06:00';

      const badge = document.getElementById('home-curfew-status-badge');
      const range = document.getElementById('home-curfew-time-range');
      const msg = document.getElementById('home-curfew-msg');
      const lastUpdate = document.getElementById('home-curfew-last-update');

      if (!badge || !range || !msg) return;

      if (isEnabled) {
        badge.textContent = 'Active';
        badge.className = 'px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700 uppercase tracking-wider';

        const fmtStart = formatTime12(start);
        const fmtEnd = formatTime12(end);
        range.textContent = `${fmtStart} to ${fmtEnd}`;
        msg.textContent = `Device usage restricted during these hours.`;

        if (lastUpdate) lastUpdate.textContent = `Curfew set for ${fmtStart}`;
      } else {
        badge.textContent = 'Disabled';
        badge.className = 'px-2 py-0.5 rounded text-[10px] font-bold bg-gray-200 text-gray-500 uppercase tracking-wider';
        range.textContent = '';
        msg.textContent = 'No digital curfew is currently active.';
        if (lastUpdate) lastUpdate.textContent = 'Curfew is currently turned off.';
      }
    }

    function updateCurrentTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      const timeStr = `${String(displayHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')} ${ampm}`;

      const timeEl = document.getElementById('home-current-time');
      if (timeEl) timeEl.textContent = timeStr;

      // Check if currently within curfew
      const isEnabled = localStorage.getItem('curfew_enabled') === 'true';
      const start = localStorage.getItem('curfew_start') || '22:00';
      const end = localStorage.getItem('curfew_end') || '06:00';
      const indicator = document.getElementById('home-curfew-active-indicator');

      if (!indicator) return;

      if (isEnabled) {
        const currentMins = hours * 60 + minutes;
        const [startH, startM] = start.split(':').map(Number);
        const [endH, endM] = end.split(':').map(Number);
        const startMins = startH * 60 + startM;
        const endMins = endH * 60 + endM;

        let isInCurfew = false;
        if (startMins > endMins) {
          // Curfew spans midnight (e.g., 22:00 to 06:00)
          isInCurfew = currentMins >= startMins || currentMins < endMins;
        } else {
          // Same day curfew
          isInCurfew = currentMins >= startMins && currentMins < endMins;
        }

        if (isInCurfew) {
          indicator.textContent = 'In Curfew';
          indicator.className = 'px-2 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-700 uppercase';
        } else {
          indicator.textContent = 'Outside Curfew';
          indicator.className = 'px-2 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-700 uppercase';
        }
      } else {
        indicator.textContent = 'No Curfew';
        indicator.className = 'px-2 py-1 rounded-full text-[10px] font-bold bg-gray-100 text-gray-500 uppercase';
      }
    }

    function formatTime12(time24) {
      if (!time24) return '';
      const [h, m] = time24.split(':');
      let hours = parseInt(h);
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      return `${hours}:${m} ${ampm}`;
    }
  </script>
  <script src="google_translate.js"></script>
</body>

</html>
<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Profile - MyMULA Junior</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0054A6",
            accent: "#4CA9FF",
            "background-light": "#F7F9FC",
            "background-dark": "#0f1923",
          },
          fontFamily: {
            display: ["Public Sans", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.25rem",
            lg: "12px",
            xl: "16px",
            full: "9999px",
          },
        },
      },
    };
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
    }

    .material-symbols-outlined.fill {
      font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
    }

    body {
      min-height: max(884px, 100dvh);
    }

    .bounce-on-tap:active {
      transform: scale(0.95);
      transition: transform 0.1s ease-in-out;
    }
  </style>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
</head>

<body class="font-display bg-background-light">
  <div
    class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
    <div class="flex items-center bg-transparent dark:bg-background-dark p-4 justify-between">
      <div class="flex items-center gap-3 w-12"></div>
      <h1 class="text-[#333333] dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] flex-1 text-center">
        Profile
      </h1>
      <div class="flex w-12 items-center justify-end relative">
        <button
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-transparent text-[#333333] dark:text-white gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0">
          <span class="material-symbols-outlined !text-3xl">notifications</span>
        </button>
        <div class="absolute top-1 right-1 h-2.5 w-2.5 rounded-full bg-red-500 border-2 border-background-light"></div>
      </div>
    </div>
    <div class="flex flex-col items-center flex-grow p-4">
      <div class="flex flex-col items-center">
        <img alt="Ali's avatar" class="h-[100px] w-[100px] rounded-full object-cover border-2 border-primary shadow-lg"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuCsYcXFkFsFledf_qaRhclLFxukFFj7_RpSh9rCzy78mBo-x0GF7vKE_S91r-iJBE-H4ycYLv-s2-9Vd6p0huSFXTg-ZLbFHKzINUXDEDGq_OVHbTPMzOs96CZ7hMZnjsfA2bV37BrgOQxMb979KFt1kIb63ZoAJXZtE9VuJbAfDQ36MemKQbLx8DBjF5-mavhrhE7v7cyC2WNBEce6mmCCGVV7nOEznLYlcQIWdUOiqO4k_o1-JM8O8q7PhwPwc9EvnCu94vVXQss" />
        <div class="mt-6 text-center">
          <p class="text-xl font-bold text-gray-900 dark:text-white">Ali</p>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            ******-**-1234
          </p>
        </div>
      </div>
      <div class="w-full max-w-md mt-8 space-y-4">
        <div
          class="bg-white dark:bg-gray-800 rounded-xl p-4 flex items-center justify-between shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors"
          onclick="window.location.href='link_guardian.html'" id="guardianSection">
          <div class="flex items-center gap-4">
            <div class="bg-gray-100 dark:bg-gray-700 rounded-full p-2">
              <span class="material-symbols-outlined text-primary !text-2xl">verified_user</span>
            </div>
            <div>
              <p class="font-semibold text-gray-900 dark:text-white">
                Linked Guardian
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400" id="guardianStatusText">
                Not Linked
              </p>
            </div>
          </div>
          <span class="material-symbols-outlined text-gray-400">chevron_right</span>
        </div>

        <!-- Child Documents Section -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm space-y-4">
          <h3 class="font-bold text-gray-900 dark:text-white text-sm">Child Documents</h3>

          <!-- Wrapper for "Add More" Button - Now at the top -->
          <div id="addMoreSection" class="hidden pb-2 border-b border-gray-100 dark:border-gray-700 mb-2">
            <button onclick="addCustomDocument()"
              class="w-full flex items-center justify-center gap-2 py-2 text-primary font-bold text-sm bg-primary/5 hover:bg-primary/10 rounded-lg transition-colors">
              <span class="material-symbols-outlined text-lg">add_circle</span>
              Add More Documents
            </button>
          </div>

          <!-- Container for Custom Documents - Now at the top -->
          <div id="customDocsContainer"></div>

          <!-- Birth Certificate -->
          <div
            class="flex items-center justify-between border-b border-gray-100 dark:border-gray-700 pb-3 last:border-0 last:pb-0">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500">
                <span class="material-symbols-outlined !text-xl">child_care</span>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-900 dark:text-white">Birth Certificate</p>
                <p class="text-xs text-orange-500 font-medium" id="birthCertStatus">Required</p>
              </div>
            </div>
            <!-- This button would also trigger a scan flow, reusing the logic or a similar page -->
            <button id="birthBtn"
              class="bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors p-2 rounded-lg text-xs font-bold"
              onclick="window.location.href='scan_document.html?type=birth'">
              Scan
            </button>
          </div>

          <!-- SPM Certificate -->
          <div
            class="flex items-center justify-between border-b border-gray-100 dark:border-gray-700 pb-3 last:border-0 last:pb-0">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-500">
                <span class="material-symbols-outlined !text-xl">school</span>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-900 dark:text-white">SPM Certificate</p>
                <p class="text-xs text-orange-500 font-medium" id="spmStatus">Required</p>
              </div>
            </div>
            <button id="spmBtn"
              class="bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors p-2 rounded-lg text-xs font-bold"
              onclick="window.location.href='scan_document.html?type=spm'">
              Scan
            </button>
          </div>

          <!-- Co-Curriculum -->
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center text-orange-500">
                <span class="material-symbols-outlined !text-xl">sports_soccer</span>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-900 dark:text-white">Co-Curriculum</p>
                <p class="text-xs text-orange-500 font-medium" id="coqStatus">Required</p>
              </div>
            </div>
            <button id="coqBtn"
              class="bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors p-2 rounded-lg text-xs font-bold"
              onclick="window.location.href='scan_document.html?type=coq'">
              Scan
            </button>
          </div>
        </div>
        <button class="w-full bg-primary text-white font-bold py-3 px-4 rounded-xl shadow-md bounce-on-tap">
          Manage Permissions
        </button>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
          <div class="p-4 flex items-center justify-between border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-4">
              <div class="bg-gray-100 dark:bg-gray-700 rounded-full p-2">
                <span class="material-symbols-outlined text-primary !text-2xl">language</span>
              </div>
              <p class="font-semibold text-gray-900 dark:text-white">Language</p>
            </div>
            <div class="flex items-center gap-1 bg-gray-100 dark:bg-gray-700 p-1 rounded-full">
              <button class="px-3 py-1 text-sm font-semibold text-white bg-primary rounded-full">
                EN
              </button>
              <button class="px-3 py-1 text-sm font-semibold text-gray-500 dark:text-gray-400">
                BM
              </button>
            </div>
          </div>
          <div class="p-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="bg-gray-100 dark:bg-gray-700 rounded-full p-2">
                <span class="material-symbols-outlined text-primary !text-2xl">help_outline</span>
              </div>
              <p class="font-semibold text-gray-900 dark:text-white">
                Help &amp; Security
              </p>
            </div>
            <span class="material-symbols-outlined text-gray-400">chevron_right</span>
          </div>
        </div>
        <div class="pt-4 text-center">
          <button onclick="handleLogout()"
            class="text-red-500 font-bold flex items-center justify-center gap-2 w-full py-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors">
            <span class="material-symbols-outlined">logout</span>
            Log Out
          </button>
        </div>
      </div>
    </div>
    <div class="sticky bottom-0">
      <div
        class="flex h-[72px] justify-around border-t border-[#f0f2f5] bg-white/80 px-4 pb-3 pt-2 dark:border-gray-700 dark:bg-background-dark/80 backdrop-blur-lg">

        <!-- 1. HOME BUTTON -->
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
          href="mainpage_home.html">
          <div class="flex h-8 items-center justify-center">
            <span class="material-symbols-outlined">home</span>
          </div>
          <p class="text-xs font-semibold leading-normal tracking-[0.015em]">Home</p>
        </a>

        <!-- 2. MY APPLICATIONS BUTTON -->
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
          href="mainpage_applications.html">
          <div class="flex h-8 items-center justify-center">
            <span class="material-symbols-outlined">description</span>
          </div>
          <p class="text-xs font-semibold leading-normal tracking-[0.015em]">My Applications</p>
        </a>

        <!-- 3. PROFILE BUTTON -->
        <a class="flex flex-1 flex-col items-center justify-end gap-1 rounded-full text-primary"
          href="mainpage_profile.html">
          <div class="flex h-8 items-center justify-center">
            <span class="material-symbols-outlined fill">account_circle</span>
          </div>
          <p class="text-primary text-xs font-semibold leading-normal tracking-[0.015em]">Profile</p>
        </a>

      </div>
    </div>
  </div>
  <script>
    // Using sessionStorage instead of localStorage for demo purposes
    // sessionStorage persists during navigation but clears when browser tab is closed
    document.addEventListener('DOMContentLoaded', () => {
      // No manual reset needed - sessionStorage handles it automatically on tab close

      const guardianStatus = localStorage.getItem('guardian_status');


      if (guardianStatus === 'waiting_verification') {
        const statusText = document.getElementById('guardianStatusText');
        // User requested "Waiting Verification" instead of "Verify: IC"
        statusText.innerHTML = `<span class="text-orange-500 font-medium flex items-center gap-1"><span class="material-symbols-outlined !text-sm">pending</span> Waiting Verification</span>`;
      }

      // Check SPM Status
      const spmStatus = sessionStorage.getItem('spm_status');
      const spmSummary = sessionStorage.getItem('spm_summary'); // Get saved summary

      if (spmStatus === 'waiting') {
        // Show Summary + Waiting
        const text = spmSummary ? `${spmSummary} - Waiting Verification` : 'Waiting Verification';
        updateDocStatus('spm', text, 'text-orange-500', true);

        // SIMULATION: Auto-verify after 10 seconds for demo
        setTimeout(() => {
          sessionStorage.setItem('spm_status', 'verified');
          updateDocStatus('spm', 'Verified', 'text-green-500', true);
          showAddMore();
        }, 10000);
      } else if (spmStatus === 'verified') {
        updateDocStatus('spm', 'Verified', 'text-green-500', true);
        showAddMore();
      }

      // Check Co-Q Status
      const coqStatus = sessionStorage.getItem('coq_status');
      const coqSummary = sessionStorage.getItem('coq_summary'); // Get saved summary

      if (coqStatus === 'waiting') {
        const text = coqSummary ? `${coqSummary} - Waiting Verification` : 'Waiting Verification';
        updateDocStatus('coq', text, 'text-orange-500', true);

        // SIMULATION: Auto-verify after 10 seconds for demo
        setTimeout(() => {
          sessionStorage.setItem('coq_status', 'verified');
          updateDocStatus('coq', 'Verified', 'text-green-500', true);
          showAddMore();
        }, 10000);
      } else if (coqStatus === 'verified') {
        updateDocStatus('coq', 'Verified', 'text-green-500', true);
        showAddMore();
      }

      // Check Birth Cert Status (Child)
      const birthStatus = sessionStorage.getItem('birth_status');
      const birthSummary = sessionStorage.getItem('birth_summary');

      if (birthStatus === 'waiting') {
        const text = birthSummary ? `${birthSummary} - Waiting Verification` : 'Waiting Verification';
        updateDocStatus('birthCert', text, 'text-orange-500', true);

        // SIMULATION: Auto-verify after 10 seconds for demo (same as SPM)
        setTimeout(() => {
          sessionStorage.setItem('birth_status', 'verified');
          updateDocStatus('birthCert', 'Verified', 'text-green-500', true);
          showAddMore();
        }, 10000);
      } else if (birthStatus === 'verified') {
        updateDocStatus('birthCert', 'Verified', 'text-green-500', true);
        showAddMore();
      }

      function updateDocStatus(type, text, colorClass, disableBtn) {
        let statusEl, btnEl;

        // Special handling for birthCert ID mismatch
        if (type === 'birthCert') {
          statusEl = document.getElementById('birthCertStatus');
          btnEl = document.getElementById('birthBtn');
        } else {
          statusEl = document.getElementById(type + 'Status');
          btnEl = document.getElementById(type + 'Btn');
        }

        if (statusEl) {
          statusEl.innerText = text;
          statusEl.className = "text-xs font-medium " + colorClass;
        }

        if (disableBtn && btnEl) {
          if (text === 'Verified') {
            btnEl.innerHTML = '<span class="material-symbols-outlined !text-base">check_circle</span>';
            btnEl.classList.remove('bg-gray-100', 'text-gray-500', 'bg-primary/10', 'text-primary');
            btnEl.classList.add('bg-green-100', 'text-green-600');
            btnEl.disabled = true;
          } else {
            btnEl.innerText = "Pending";
            btnEl.disabled = true;
            btnEl.classList.add('opacity-50', 'cursor-not-allowed');
          }
        }
      }

      function showAddMore() {
        const section = document.getElementById('addMoreSection');
        if (section) section.classList.remove('hidden');
      }

      // === Add Document Modal Logic ===
      function addCustomDocument() {
        // Open the modal instead of prompt
        const modal = document.getElementById('addDocModal');
        modal.classList.remove('hidden');
        // Animation entry
        const panel = modal.querySelector('div');
        panel.classList.remove('scale-95', 'opacity-0');
        panel.classList.add('scale-100', 'opacity-100');
      }

      window.closeAddDocModal = function () {
        const modal = document.getElementById('addDocModal');
        modal.classList.add('hidden');
      }

      window.selectDocumentType = function (name) {
        closeAddDocModal();

        let list = JSON.parse(sessionStorage.getItem('custom_docs_list') || '[]');
        if (list.includes(name)) {
          alert(name + " is already added.");
          return;
        }

        list.push(name);
        sessionStorage.setItem('custom_docs_list', JSON.stringify(list));
        renderCustomDocRow(name);

        // Optional: Auto scroll to new item
        setTimeout(() => {
          const el = document.getElementById(`doc-row-${name}`);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }

      function loadCustomDocs() {
        const list = JSON.parse(sessionStorage.getItem('custom_docs_list') || '[]');
        list.forEach(name => renderCustomDocRow(name));
      }

      function renderCustomDocRow(name) {
        const decodedName = decodeURIComponent(name);
        const container = document.getElementById('customDocsContainer');
        if (document.getElementById(`doc-row-${decodedName}`)) return;

        // Ensure we retrieve status using the exact same key format
        const storageKey = decodedName;
        const status = sessionStorage.getItem(`${storageKey}_status`);
        const isWaiting = status === 'waiting';
        const isVerified = status === 'verified';

        const statusText = isWaiting ? 'Pending Verification' : (isVerified ? 'Verified' : 'Not Uploaded');
        const statusClass = isWaiting ? 'text-orange-500' : (isVerified ? 'text-green-500' : 'text-gray-400');

        const rowHtml = `
          <div id="doc-row-${decodedName}" class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700 pt-3 mt-3">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-teal-50 dark:bg-teal-900/20 flex items-center justify-center text-teal-500">
                <span class="material-symbols-outlined !text-xl">description</span>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-900 dark:text-white">${decodedName}</p>
                <p class="text-xs ${statusClass}" id="custom_${decodedName}Status">${statusText}</p>
              </div>
            </div>
            <button id="custom_${decodedName}Btn"
              class="bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors p-2 rounded-lg text-xs font-bold"
              onclick="window.location.href='scan_document.html?type=custom&name=${encodeURIComponent(decodedName)}'">
              ${isVerified ? 'View' : 'Scan'}
            </button>
          </div>
        `;

        container.insertAdjacentHTML('beforeend', rowHtml);

        // Auto-update simulation if waiting
        if (isWaiting) {
          setTimeout(() => {
            sessionStorage.setItem(`${storageKey}_status`, 'verified');
            // Update UI directly without reload
            const statusEl = document.getElementById(`custom_${decodedName}Status`);
            if (statusEl) {
              statusEl.innerText = 'Verified';
              statusEl.className = 'text-xs text-green-500';
            }
            const btn = document.getElementById(`custom_${decodedName}Btn`);
            if (btn) btn.innerText = 'View';
          }, 4000);
        }
      }

      // Make functions globally accessible
      window.addCustomDocument = addCustomDocument;

      // Load Custom Docs on startup
      loadCustomDocs();
    });

    // === LOGOUT FUNCTIONALITY ===
    function handleLogout() {
      // Show confirmation
      if (confirm('Are you sure you want to log out? Your application drafts will be saved.')) {
        // Preserve all important sessionStorage data
        const dataToPreserve = {};
        const keysToPreserve = [
          'adult_registered', 'adult_name', 'adult_documents',  // Adult registration
          'child_requests',                                       // Child requests
          'draft_scholarship', 'draft_sme', 'draft_dental',      // Application drafts
          'guardian_approved', 'sme_guardian_approved', 'dental_guardian_approved'  // Guardian approval status
        ];

        keysToPreserve.forEach(key => {
          const value = sessionStorage.getItem(key);
          if (value) dataToPreserve[key] = value;
        });

        // Clear sessionStorage (session-specific data)
        sessionStorage.clear();

        // Restore preserved data
        Object.entries(dataToPreserve).forEach(([key, value]) => {
          sessionStorage.setItem(key, value);
        });

        console.log('Logged out. Data preserved:', Object.keys(dataToPreserve).length);

        // Redirect to index/login page
        window.location.href = 'index.html';
      }
    }
  </script>

  <!-- Add Document Modal -->
  <div id="addDocModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div
      class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-sm overflow-hidden shadow-2xl transform transition-all scale-100">
      <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Add Document</h3>
        <button onclick="closeAddDocModal()"
          class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="p-4 space-y-3">
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Select a document type to add:</p>

        <button onclick="selectDocumentType('Car Licenses')"
          class="w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors text-left group">
          <div
            class="w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500 group-hover:bg-blue-100">
            <span class="material-symbols-outlined">directions_car</span>
          </div>
          <span class="font-semibold text-gray-700 dark:text-gray-200">Car Licenses</span>
        </button>

        <button onclick="selectDocumentType('Passport Number')"
          class="w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors text-left group">
          <div
            class="w-10 h-10 rounded-full bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-red-500 group-hover:bg-red-100">
            <span class="material-symbols-outlined">flight</span>
          </div>
          <span class="font-semibold text-gray-700 dark:text-gray-200">Passport Number</span>
        </button>
      </div>
    </div>
  </div>
</body>

</html>
<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Home - MyMULA</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#0d7ff2",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"],
                    },
                },
            },
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
            font-size: 24px;
        }

        body {
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .dark .glass-card {
            background: rgba(16, 25, 34, 0.9);
        }

        .gradient-header {
            background: linear-gradient(135deg, #0d7ff2 0%, #00d4ff 100%);
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="font-display bg-background-light dark:bg-background-dark">
    <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Top App Bar -->
        <div class="sticky top-0 z-10 gradient-header px-6 py-6 rounded-b-[2rem] shadow-lg">
            <div class="flex items-center justify-between text-white mb-2">
                <div class="flex items-center gap-4">
                    <div
                        class="size-14 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white text-2xl font-bold border-2 border-white/30">
                        S
                    </div>
                    <div>
                        <h1 class="text-white text-2xl font-bold leading-tight">
                            Hi, Sarah!
                        </h1>
                        <p class="text-white/80 text-sm font-medium">Have a great day!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 px-5 py-6">
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 gap-4 mb-8">
                <!-- Linked Child Card -->
                <div class="glass-card rounded-3xl p-5 shadow-sm border border-white/50 dark:border-gray-800 animate-slide-up"
                    style="animation-delay: 0.1s">
                    <div
                        class="size-12 rounded-2xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4 text-primary">
                        <span class="material-symbols-outlined text-3xl">face</span>
                    </div>
                    <div class="text-3xl font-bold text-[#111418] dark:text-white mb-1">
                        1
                    </div>
                    <div class="text-sm font-medium text-[#60758a] dark:text-gray-400">
                        Linked<br />Child
                    </div>
                </div>

                <!-- Pending Requests Card -->
                <div class="glass-card rounded-3xl p-5 shadow-sm border border-white/50 dark:border-gray-800 animate-slide-up"
                    style="animation-delay: 0.2s">
                    <div
                        class="size-12 rounded-2xl bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center mb-4 text-orange-500">
                        <span class="material-symbols-outlined text-3xl">folder_shared</span>
                    </div>
                    <div id="pendingCount" class="text-3xl font-bold text-[#111418] dark:text-white mb-1">
                        0
                    </div>
                    <div class="text-sm font-medium text-[#60758a] dark:text-gray-400">
                        Pending<br />Requests
                    </div>
                </div>
            </div>

            <!-- Linked Children Section -->
            <div class="mb-8 animate-slide-up" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between mb-4 px-1">
                    <h2 class="text-[#111418] dark:text-white text-lg font-bold flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">people</span>
                        Linked Children
                    </h2>
                </div>

                <!-- Child Card -->
                <div
                    class="glass-card rounded-3xl p-5 shadow-sm border border-white/50 dark:border-gray-800 flex items-center gap-4 hover:shadow-md transition-all">
                    <img src="https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=100&h=100&fit=crop"
                        alt="Ali profile"
                        class="size-16 rounded-2xl object-cover ring-2 ring-gray-100 dark:ring-gray-800" />
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-[#111418] dark:text-white text-lg font-bold">
                                Ali
                            </h3>
                            <span
                                class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-primary text-[10px] font-bold uppercase tracking-wider rounded-full">Junior</span>
                        </div>
                        <p class="text-[#60758a] dark:text-gray-400 text-sm mb-2">
                            Age 16
                        </p>
                        <div class="flex items-center gap-1.5 text-green-600">
                            <span class="material-symbols-outlined text-[18px] fill">verified</span>
                            <span class="text-xs font-semibold">Account Linked</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="animate-slide-up pb-24" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-4 px-1">
                    <h2 class="text-[#111418] dark:text-white text-lg font-bold flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">history</span>
                        Recent Activity
                    </h2>
                    <a href="adult_requests.html" class="text-primary text-sm font-semibold hover:underline">View
                        All</a>
                </div>

                <!-- Activity List Container -->
                <div id="recentActivityList" class="flex flex-col gap-3">
                    <!-- Dynamic content will be loaded here -->
                    <div class="text-center py-8 text-gray-400">
                        <p>Loading activity...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="sticky bottom-0 bg-white dark:bg-background-dark border-t border-[#f0f2f5] dark:border-gray-700">
            <div class="flex h-[72px] justify-around px-4 pb-3 pt-2">
                <a class="flex flex-1 flex-col items-center justify-end gap-1 text-primary" href="adult_home.html">
                    <div class="flex h-8 items-center justify-center">
                        <span class="material-symbols-outlined notranslate fill">home</span>
                    </div>
                    <p class="text-primary text-xs font-semibold">Home</p>
                </a>

                <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
                    href="adult_requests.html">
                    <div class="flex h-8 items-center justify-center relative">
                        <span class="material-symbols-outlined notranslate">pending_actions</span>
                        <div id="navPendingBadge"
                            class="hidden absolute -top-1 -right-3 size-4 bg-red-500 rounded-full flex items-center justify-center border-2 border-white dark:border-background-dark">
                            <span id="navPendingCount" class="text-white text-[9px] font-bold">0</span>
                        </div>
                    </div>
                    <p class="text-xs font-semibold">Requests</p>
                </a>

                <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#6c757d] dark:text-gray-400 hover:text-primary transition-colors"
                    href="adult_profile.html">
                    <div class="flex h-8 items-center justify-center">
                        <span class="material-symbols-outlined notranslate">account_circle</span>
                    </div>
                    <p class="text-xs font-semibold">Profile</p>
                </a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            initDashboard();
        });

        function initDashboard() {
            // Load requests from Storage (no mock data - badge only shows for real requests)
            let requests = JSON.parse(
                sessionStorage.getItem("child_requests") || "[]"
            );

            // Update Counts - only count pending requests
            const pendingCount = requests.filter(
                (r) => r.status === "pending"
            ).length;

            // 1. Stats Card
            document.getElementById("pendingCount").textContent = pendingCount;

            // 2. Nav Badge
            const badge = document.getElementById("navPendingBadge");
            const badgeCount = document.getElementById("navPendingCount");
            if (pendingCount > 0) {
                badge.classList.remove("hidden");
                badgeCount.textContent = pendingCount > 9 ? "9+" : pendingCount;
            } else {
                badge.classList.add("hidden");
            }

            // 3. Recent Activity
            updateRecentActivity(requests);
        }

        function updateRecentActivity(requests) {
            const container = document.getElementById("recentActivityList");

            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/50 dark:border-gray-800">
                        <span class="material-symbols-outlined text-4xl mb-2 text-gray-300">history</span>
                        <p class="text-sm">No recent activity</p>
                    </div>
                `;
                return;
            }

            // Sort by timestamp desc and take top 3
            const recent = requests
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 3);

            container.innerHTML = recent
                .map(
                    (req) => `
                <div onclick="window.location.href='adult_requests.html'" class="glass-card rounded-3xl p-4 shadow-sm border border-white/50 dark:border-gray-800 flex items-center gap-4 cursor-pointer hover:shadow-md transition-all group">
                    <div class="size-12 rounded-2xl ${getTypeColor(
                        req.type
                    )} flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined ${getTypeTextColor(
                        req.type
                    )}">${getTypeIcon(req.type)}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-[#111418] dark:text-white font-semibold mb-1 truncate text-sm sm:text-base">
                            ${req.title}
                        </h3>
                        <p class="text-[#60758a] dark:text-gray-400 text-xs sm:text-sm">From: ${req.childName
                        } â€¢ ${getRelativeTime(req.timestamp)}</p>
                    </div>
                    <div class="flex items-center gap-2 shrink-0">
                        <div class="px-2.5 py-1 ${getStatusColor(
                            req.status
                        )} rounded-full hidden sm:block">
                            <span class="${getStatusTextColor(
                            req.status
                        )} text-xs font-bold uppercase tracking-wide">${req.status
                        }</span>
                        </div>
                        <button class="text-gray-400 dark:text-gray-500 group-hover:text-primary transition-colors">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </button>
                    </div>
                </div>
            `
                )
                .join("");
        }

        // Helper functions
        function getTypeIcon(type) {
            const icons = {
                scholarship: "school",
                sme: "business_center",
                dental: "dentistry",
                age_verification: "verified_user",
                transaction: "stadia_controller",
            };
            return icons[type] || "description";
        }

        function getTypeColor(type) {
            const colors = {
                scholarship: "bg-blue-50 dark:bg-blue-900/20",
                sme: "bg-green-50 dark:bg-green-900/20",
                dental: "bg-purple-50 dark:bg-purple-900/20",
                age_verification: "bg-orange-50 dark:bg-orange-900/20",
                transaction: "bg-pink-50 dark:bg-pink-900/20",
            };
            return colors[type] || "bg-gray-50";
        }

        function getTypeTextColor(type) {
            const colors = {
                scholarship: "text-blue-500",
                sme: "text-green-500",
                dental: "text-purple-500",
                age_verification: "text-orange-500",
                transaction: "text-pink-500",
            };
            return colors[type] || "text-gray-500";
        }

        function getStatusColor(status) {
            return status === "approved"
                ? "bg-green-50 dark:bg-green-900/20"
                : "bg-orange-50 dark:bg-orange-900/20";
        }

        function getStatusTextColor(status) {
            return status === "approved" ? "text-green-600" : "text-orange-600";
        }

        function getRelativeTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);

            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return "Yesterday";
        }
    </script>
    <script src="google_translate.js"></script>
</body>

</html>
<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Parental Control Settings - MyMULA Junior</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0d7ff2",
            "background-light": "#f5f7f8",
            "background-dark": "#101922",
          },
          fontFamily: {
            "display": ["Public Sans", "sans-serif"]
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
      font-size: 24px;
    }

    body {
      min-height: 100vh;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-slide-in {
      animation: slideIn 0.3s ease-out;
    }
  </style>
</head>

<body class="font-display bg-background-light dark:bg-background-dark">
  <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden pb-24">
    <!-- TopAppBar -->
    <div
      class="sticky top-0 z-10 flex items-center bg-white dark:bg-background-dark p-4 justify-between border-b border-gray-200 dark:border-gray-800">
      <button onclick="goBack()"
        class="text-[#111418] dark:text-white flex items-center justify-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full p-2 transition-colors">
        <span class="material-symbols-outlined notranslate">arrow_back</span>
      </button>
      <h2 class="text-[#111418] dark:text-white text-lg font-bold leading-tight flex-1 text-center">
        Digital Curfew &amp; Controls</h2>
      <div class="w-10"></div>
    </div>

    <div class="flex-grow">
      <!-- HeadlineText & MetaText -->
      <div class="bg-white dark:bg-background-dark pt-5 px-4">
        <h2 class="text-[#111418] dark:text-white text-[28px] font-bold leading-tight pb-1">
          Controls for Ali Bin Abu</h2>
        <p class="text-[#60758a] dark:text-gray-400 text-base pb-3">Age 16</p>
      </div>

      <!-- Section 1: Global Curfew Settings -->
      <div class="bg-white dark:bg-background-dark pt-6 pb-4">
        <h3 class="text-[#111418] dark:text-white text-lg font-bold px-4 pb-3">
          Global Curfew Settings</h3>

        <!-- Enable Curfew Toggle -->
        <div
          class="flex items-center gap-4 bg-white dark:bg-background-dark px-4 py-4 border-b border-gray-100 dark:border-gray-800">
          <div
            class="text-primary flex items-center justify-center rounded-xl bg-blue-50 dark:bg-blue-900/20 shrink-0 size-12">
            <span class="material-symbols-outlined notranslate">shield_moon</span>
          </div>
          <p class="text-[#111418] dark:text-white text-base font-medium flex-1">
            Enable Digital Curfew</p>
          <div class="shrink-0">
            <label
              class="relative flex h-8 w-14 cursor-pointer items-center rounded-full border-none p-1 has-[:checked]:justify-end bg-gray-200 dark:bg-gray-700 has-[:checked]:bg-primary transition-all">
              <div class="h-6 w-6 rounded-full bg-white transition-all shadow-md"></div>
              <input id="curfewToggle" checked class="invisible absolute" type="checkbox"
                onchange="updateCurfewState()" />
            </label>
          </div>
        </div>

        <!-- Curfew Starts -->
        <div onclick="document.getElementById('startTimeInput').showPicker()"
          class="flex items-center gap-4 bg-white dark:bg-background-dark px-4 py-4 border-b border-gray-100 dark:border-gray-800 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 active:bg-gray-100 dark:active:bg-gray-800 transition-colors">
          <div
            class="text-primary flex items-center justify-center rounded-xl bg-blue-50 dark:bg-blue-900/20 shrink-0 size-12">
            <span class="material-symbols-outlined notranslate">dark_mode</span>
          </div>
          <p class="text-[#111418] dark:text-white text-base flex-1">
            Curfew Starts</p>
          <div class="flex items-center gap-2">
            <p id="startTimeDisplay" class="text-primary text-base font-semibold">10:00 PM</p>
            <span class="material-symbols-outlined notranslate text-gray-400">chevron_right</span>
          </div>
          <input type="time" id="startTimeInput" class="absolute opacity-0 pointer-events-none"
            onchange="updateStartTime(this.value)">
        </div>

        <!-- Curfew Ends -->
        <div onclick="document.getElementById('endTimeInput').showPicker()"
          class="flex items-center gap-4 bg-white dark:bg-background-dark px-4 py-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 active:bg-gray-100 dark:active:bg-gray-800 transition-colors">
          <div
            class="text-primary flex items-center justify-center rounded-xl bg-blue-50 dark:bg-blue-900/20 shrink-0 size-12">
            <span class="material-symbols-outlined notranslate">light_mode</span>
          </div>
          <p class="text-[#111418] dark:text-white text-base flex-1">
            Curfew Ends</p>
          <div class="flex items-center gap-2">
            <p id="endTimeDisplay" class="text-primary text-base font-semibold">07:00 AM</p>
            <span class="material-symbols-outlined notranslate text-gray-400">chevron_right</span>
          </div>
          <input type="time" id="endTimeInput" class="absolute opacity-0 pointer-events-none"
            onchange="updateEndTime(this.value)">
        </div>

        <p class="text-[#60758a] dark:text-gray-400 text-sm py-3 px-4">
          Access to social media and non-essential apps will be revoked during this time.</p>
      </div>

      <div class="h-3 bg-background-light dark:bg-background-dark"></div>

      <!-- Section 2: App Restrictions -->
      <div class="bg-white dark:bg-background-dark pt-6 pb-4">
        <h3 class="text-[#111418] dark:text-white text-lg font-bold px-4 pb-3">
          App Restrictions</h3>

        <!-- TikTok -->
        <div class="px-4 py-4 border-b border-gray-100 dark:border-gray-800">
          <div class="flex items-center gap-4 mb-3">
            <img class="size-14 shrink-0 rounded-xl" alt="TikTok"
              src="https://lh3.googleusercontent.com/aida-public/AB6AXuBnDcgrbBUDDRMqWEoJf-GRQXRF2HGCBPL9-rAkYWTHuMMlHWKFCa2_YLsxHIo4HUcatpfGap_Mqe-NX24r480laNu43EPZPhQWl7f3YalXXDoabPCVRj5dr7xB87BpH1KNZIXFvwnpvC3vpAFpiCbU_v6n8Xf7meSz7LB79PxeKvg1iOfEpiF23PA5gDShU6ho2p2J55CpjJR_VU58R8BLv0BobiLSfgFJCATua_3x3nz_LhDTG-qM8BrtO5Lt3WGk9NGS7yOTTNI" />
            <div class="flex-1">
              <p class="text-[#111418] dark:text-white text-base font-semibold mb-1">TikTok</p>
              <p id="tiktokStatus" class="text-orange-500 text-sm">Restricted during Curfew Hours</p>
            </div>
          </div>
          <button id="tiktokBtn" onclick="allowOverride('TikTok')"
            class="w-full text-center text-primary text-sm font-semibold py-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 active:scale-[0.98] transition-all">
            Allow usage for 30 min override</button>
        </div>

        <!-- Mobile Legends -->
        <div class="px-4 py-4 border-b border-gray-100 dark:border-gray-800">
          <div class="flex items-center gap-4 mb-3">
            <img class="size-14 shrink-0 rounded-xl" alt="Mobile Legends"
              src="https://lh3.googleusercontent.com/aida-public/AB6AXuAVCHkfrTYGoAJfBbK3ExexwVTw2NaiBP91e6BH6Xb5uXwe8h2mt7GDJP18k2DgJbqjA-99rg-jbMr_hdSZgVo0Pn5vfqlSuZ4LK0tdfxv5tgMJShM53Hk_diub4Sy3dSiIspFeG9snfy-nZ-Q6Bytuj-4hX7hY96eZsoz_br-OLAMi4wzcwcmpcXrrKKnuOlmvzOENl0RaqwXCb6_AsOp6PK2M9Qq2mwdPvYwoNYlb6tx1mkpGKMISm-m_lMJrPKVKqDvkNhCMtaw" />
            <div class="flex-1">
              <p class="text-[#111418] dark:text-white text-base font-semibold mb-1">Mobile Legends</p>
              <p id="mlStatus" class="text-blue-500 text-sm">Payment Gateway Active (>RM<span id="mlLimit">20</span>
                Limit)</p>
            </div>
          </div>
          <button onclick="adjustLimit()"
            class="w-full text-center text-primary text-sm font-semibold py-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 active:scale-[0.98] transition-all">
            Adjust Spending Limit</button>
        </div>

        <!-- Education Portal -->
        <div class="px-4 py-4">
          <div class="flex items-center gap-4">
            <img class="size-14 shrink-0 rounded-xl" alt="Education Portal"
              src="https://lh3.googleusercontent.com/aida-public/AB6AXuDT64VKn3TLpdjKaWNar4xdk8sZpah5atn-9TDBnYCJgNrrupkUCdKwFQsSFfAgAFja_jtxmG4QXfqF2v4k4T-mMviogzesoHEG3qsu89UFqfgYnW4Ym7_WnbMyM5QgCOb-mF8AVq0rRiJIZgsJpSHVBwOOuc9LbdHkbbHKwwmEVHYKLhktq6gG5qnSCHFmNQNLRVA360UnqLWiDqRfozc1rjdKgkjjwnVCnB1VJ7RdBM7jDtltrGuF8H_v_I7Kp6GxxVweVKf71qQ" />
            <div class="flex-1">
              <p class="text-[#111418] dark:text-white text-base font-semibold mb-1">Education Portal</p>
              <p class="text-green-600 text-sm">Always Allowed (Exempt from Curfew)</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sticky Action Button -->
    <div
      class="fixed bottom-0 left-0 right-0 p-4 bg-white dark:bg-background-dark border-t border-gray-200 dark:border-gray-800">
      <button onclick="saveSettings()"
        class="w-full text-white text-base font-bold py-4 rounded-xl bg-primary shadow-lg hover:bg-primary/90 active:scale-[0.98] transition-all">
        Save &amp; Push New Settings</button>
    </div>
  </div>

  <!-- Toast Notification Container -->
  <div id="toastContainer" class="fixed top-20 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-2 pointer-events-none">
  </div>

  <script>
    // App state
    let appState = {
      curfew: {
        enabled: true,
        startTime: '22:00',
        endTime: '07:00'
      },
      apps: {
        tiktok: {
          overrideActive: false,
          overrideEndTime: null,
          countdownInterval: null
        },
        mobileLegends: {
          spendingLimit: 20
        }
      }
    };

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
    });

    function loadSettings() {
      // Load from localStorage if available
      const savedEnabled = localStorage.getItem('curfew_enabled');
      const savedStart = localStorage.getItem('curfew_start');
      const savedEnd = localStorage.getItem('curfew_end');

      if (savedEnabled !== null) {
        appState.curfew.enabled = savedEnabled === 'true';
      }
      if (savedStart) {
        appState.curfew.startTime = savedStart;
      }
      if (savedEnd) {
        appState.curfew.endTime = savedEnd;
      }

      document.getElementById('curfewToggle').checked = appState.curfew.enabled;
      document.getElementById('startTimeInput').value = appState.curfew.startTime;
      document.getElementById('endTimeInput').value = appState.curfew.endTime;
      document.getElementById('startTimeDisplay').textContent = formatTime(appState.curfew.startTime);
      document.getElementById('endTimeDisplay').textContent = formatTime(appState.curfew.endTime);

      // Update UI without showing toast on load
      const enabled = appState.curfew.enabled;
      const tiktokStatus = document.getElementById('tiktokStatus');
      const tiktokBtn = document.getElementById('tiktokBtn');

      if (!enabled) {
        tiktokStatus.textContent = 'Not Restricted (Curfew Disabled)';
        tiktokStatus.className = 'text-gray-500 text-sm';
        tiktokBtn.disabled = true;
        tiktokBtn.className = 'w-full text-center text-gray-400 text-sm font-semibold py-3 rounded-xl bg-gray-100 dark:bg-gray-800 cursor-not-allowed';
      } else {
        tiktokStatus.textContent = 'Restricted during Curfew Hours';
        tiktokStatus.className = 'text-orange-500 text-sm';
        tiktokBtn.disabled = false;
        tiktokBtn.className = 'w-full text-center text-primary text-sm font-semibold py-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 active:scale-[0.98] transition-all';
      }
    }

    function formatTime(timeStr) {
      if (!timeStr) return '';
      const [hour, minute] = timeStr.split(':');
      const h = parseInt(hour);
      const period = h >= 12 ? 'PM' : 'AM';
      const displayHour = h === 0 ? 12 : h > 12 ? h - 12 : h;
      return `${String(displayHour).padStart(2, '0')}:${minute} ${period}`;
    }

    function updateStartTime(value) {
      appState.curfew.startTime = value;
      document.getElementById('startTimeDisplay').textContent = formatTime(value);
      showToast('Curfew start time updated');
    }

    function updateEndTime(value) {
      appState.curfew.endTime = value;
      document.getElementById('endTimeDisplay').textContent = formatTime(value);
      showToast('Curfew end time updated');
    }

    function updateCurfewState() {
      const enabled = document.getElementById('curfewToggle').checked;
      appState.curfew.enabled = enabled;

      const tiktokStatus = document.getElementById('tiktokStatus');
      const tiktokBtn = document.getElementById('tiktokBtn');

      if (!enabled) {
        // Curfew disabled
        tiktokStatus.textContent = 'Not Restricted (Curfew Disabled)';
        tiktokStatus.className = 'text-gray-500 text-sm';
        tiktokBtn.disabled = true;
        tiktokBtn.className = 'w-full text-center text-gray-400 text-sm font-semibold py-3 rounded-xl bg-gray-100 dark:bg-gray-800 cursor-not-allowed';

        // Clear any active override
        if (appState.apps.tiktok.overrideActive) {
          clearInterval(appState.apps.tiktok.countdownInterval);
          appState.apps.tiktok.overrideActive = false;
        }
      } else if (!appState.apps.tiktok.overrideActive) {
        // Curfew enabled, no override
        tiktokStatus.textContent = 'Restricted during Curfew Hours';
        tiktokStatus.className = 'text-orange-500 text-sm';
        tiktokBtn.disabled = false;
        tiktokBtn.textContent = 'Allow usage for 30 min override';
        tiktokBtn.className = 'w-full text-center text-primary text-sm font-semibold py-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 active:scale-[0.98] transition-all';
      }

      showToast(enabled ? 'Digital Curfew enabled' : 'Digital Curfew disabled');
    }

    function allowOverride(appName) {
      if (!appState.curfew.enabled) {
        showToast('⚠ Curfew is disabled. No override needed.');
        return;
      }

      // Set override
      appState.apps.tiktok.overrideActive = true;
      appState.apps.tiktok.overrideEndTime = Date.now() + (30 * 60 * 1000);

      const tiktokStatus = document.getElementById('tiktokStatus');
      const tiktokBtn = document.getElementById('tiktokBtn');

      tiktokStatus.textContent = '30-min Override Active';
      tiktokStatus.className = 'text-green-600 text-sm font-semibold';
      tiktokBtn.disabled = true;
      tiktokBtn.className = 'w-full text-center text-green-600 text-sm font-semibold py-3 rounded-xl bg-green-50 dark:bg-green-900/20 cursor-not-allowed';

      showToast('✓ 30-minute override granted for TikTok');
      startOverrideCountdown();
    }

    function startOverrideCountdown() {
      if (appState.apps.tiktok.countdownInterval) {
        clearInterval(appState.apps.tiktok.countdownInterval);
      }

      appState.apps.tiktok.countdownInterval = setInterval(() => {
        const remaining = appState.apps.tiktok.overrideEndTime - Date.now();

        if (remaining <= 0) {
          clearInterval(appState.apps.tiktok.countdownInterval);
          appState.apps.tiktok.overrideActive = false;
          appState.apps.tiktok.overrideEndTime = null;

          const tiktokStatus = document.getElementById('tiktokStatus');
          const tiktokBtn = document.getElementById('tiktokBtn');

          tiktokStatus.textContent = 'Restricted during Curfew Hours';
          tiktokStatus.className = 'text-orange-500 text-sm';
          tiktokBtn.textContent = 'Allow usage for 30 min override';
          tiktokBtn.disabled = false;
          tiktokBtn.className = 'w-full text-center text-primary text-sm font-semibold py-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 active:scale-[0.98] transition-all';

          showToast('⏰ TikTok override has expired');
        } else {
          const minutes = Math.floor(remaining / 60000);
          const seconds = Math.floor((remaining % 60000) / 1000);
          document.getElementById('tiktokBtn').textContent =
            `Override Active (${minutes}:${seconds.toString().padStart(2, '0')} remaining)`;
        }
      }, 1000);
    }

    function adjustLimit() {
      const currentLimit = appState.apps.mobileLegends.spendingLimit;
      const input = prompt(`Enter new daily spending limit for Mobile Legends (RM):`, currentLimit);

      if (input === null) return; // User cancelled

      const newLimit = parseFloat(input);

      if (isNaN(newLimit) || newLimit <= 0) {
        alert('Please enter a valid amount greater than 0');
        return;
      }

      appState.apps.mobileLegends.spendingLimit = newLimit;
      document.getElementById('mlLimit').textContent = Math.round(newLimit);
      showToast(`✓ Spending limit updated to RM${Math.round(newLimit)}`);
    }

    function saveSettings() {
      // Save to localStorage so child's mainpage_home.html can read it
      localStorage.setItem('curfew_enabled', appState.curfew.enabled ? 'true' : 'false');
      localStorage.setItem('curfew_start', appState.curfew.startTime);
      localStorage.setItem('curfew_end', appState.curfew.endTime);
      localStorage.setItem('curfew_last_updated', new Date().toISOString());

      const summary = `Settings Saved & Pushed!

Digital Curfew: ${appState.curfew.enabled ? 'Enabled' : 'Disabled'}
${appState.curfew.enabled ? `Start: ${formatTime(appState.curfew.startTime)}\nEnd: ${formatTime(appState.curfew.endTime)}` : ''}

TikTok: ${appState.apps.tiktok.overrideActive ? '30-min override active' : 'Restricted during curfew'}
Mobile Legends: RM${appState.apps.mobileLegends.spendingLimit} daily limit
Education Portal: Always allowed

Settings have been pushed to Ali's device.`;

      showToast('✓ Settings saved successfully!');
      setTimeout(() => alert(summary), 300);
    }

    function goBack() {
      if (confirm('Go back? Any unsaved changes will be lost.')) {
        window.history.back();
      }
    }

    function showToast(message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 px-6 py-3 rounded-full shadow-xl text-sm font-medium animate-slide-in pointer-events-auto max-w-sm';
      toast.textContent = message;

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  </script>
  <script src="google_translate.js"></script>
</body>

</html>